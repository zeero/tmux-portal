# テストケース概要

`tests/tmux-portal.bats` に実装されているテストケースの概要です。このプロジェクトでは [bats-core](https://github.com/bats-core/bats-core) を使用して Bash スクリプトのテストを行っています。

## オプション組み合わせマトリクス

各オプションの組み合わせに対する挙動とテストカバレッジです。

| セッション (`-s`) | コマンド (`-c`) | スタイル (`--status-style`) | テストケース | 期待結果 |
| :--- | :--- | :--- | :---: | :--- |
| 未指定 | 未指定 | 未指定 | ✅ | セッション選択メニューを表示、選択後に切り替え |
| 指定 (既存) | 未指定 | 未指定 | ✅ | 指定された既存セッションへ切り替え |
| 指定 (新規) | 未指定 | 未指定 | ✅ | セッションを新規作成し、そこへ切り替え |
| 未指定 | 指定 | 未指定 | ✅ | セッション選択メニューを表示、選択セッションでコマンド実行 |
| 指定 | 指定 | 未指定 | ✅ | 指定セッション（必要なら作成）でコマンド実行し切り替え |
| 指定 | 未指定 | 指定 | ✅ | 指定セッションにスタイルを適用して切り替え |
| 未指定 | 未指定 | 指定 | ❌ | セッション選択後、そのセッションにスタイル適用し切り替え |
| 未指定 | 指定 | 指定 | ❌ | セッション選択、スタイル適用、コマンド実行し切り替え |
| 指定 | 指定 | 指定 | ❌ | 全てのオプションを適用（スタイル設定、コマンド実行、切り替え） |

✅: `tests/tmux-portal.bats` にテストが存在
❌: 現時点で明示的なテストが存在しない組み合わせ

## テストカテゴリ

### 1. ヘルプと基本オプション
- **ヘルプオプション: 使い方を表示**: `--help` オプションが正しく使用方法を表示することを確認します。
- **不明なオプション: エラーメッセージを表示**: 定義されていないオプションが指定された場合にエラーを返すことを確認します。
- **短縮オプション: -s でセッション指定**: `-s` が `--session` の短縮形として機能することを確認します。
- **短縮オプション: -c でコマンド指定**: `-c` が `--command` の短縮形として機能することを確認します。

### 2. セッション管理
- **セッション指定のみ: 既存セッションに切り替え**: 指定された既存のセッションに正しく切り替わることを確認します。
- **セッション指定のみ: 存在しないセッションは自動作成**: 指定されたセッションが存在しない場合、新規作成されることを確認します。
- **セッション作成: 新規セッションを作成して切り替え**: セッションの作成から切り替えまでの一連の動作を確認します。

### 3. コマンド実行と設定
- **セッション + コマンド指定: 新規ウィンドウでコマンド実行**: セッション切り替え時に指定したコマンド（`aider` など）が新規ウィンドウで実行されることを確認します。
- **ステータスラインスタイル設定**: `--status-style` オプションによって tmux のステータスラインの色設定などが正しく適用されることを確認します。
- **コマンド指定のみ: セッションスイッチャー経由で実行**: セッションを明示的に指定せずにコマンドのみ指定した場合、セッション選択後にそのセッションでコマンドが実行されることを確認します。

### 4. 実行環境のテスト
- **tmux内から実行**: すでに tmux セッション内にいる場合に、`switch-client` を使用して適切に切り替わることを確認します。
- **tmux外から実行**: tmux 外（通常のシェル）から実行した場合に、`attach-session` を使用して適切に接続されることを確認します。

### 5. セッションスイッチャーのロジック
- **セッション候補が1つの場合: 自動選択される**: 選択肢が1つしかない場合、対話プロンプトを出さずに自動的にそのセッションを選択することを確認します。
- **tmux内から実行: 現在のセッションは候補から除外される**: tmux 内からスイッチャーを起動した際、現在接続中のセッションが選択肢に現れないことを確認します。

### 6. パス復元
- **パス復元: 新規ウィンドウ作成時にカレントディレクトリを指定**: 新規ウィンドウ作成時に、スクリプト実行時のカレントディレクトリが正しく引き継がれることを確認します。

## テストの実行方法

```bash
bats tests/tmux-portal.bats
```

詳細はプロジェクトルートの `CLAUDE.md` を参照してください。
